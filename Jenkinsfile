pipeline {
    agent any
    environment {
        PATH = "$PATH:/etc/maven/apache-maven-3.8.4/bin"
    }
    stages {
        stage("list env vars") {
            steps {
                sh "printenv | sort"
            }
        }
        stage('Build') {
            steps {
                script {
                    sh 'mvn clean package'
                }
            }
        }
        stage("SpnarQube analysis") {
            steps {
                withSonarQubeEnv("sonarqube-8.9.2") {
                    sh "mvn sonar:sonar"
                }        
            }
        }                
    }
    post {
        success {
            script{
                emailBody = "Hi Sender,\nThis is an autogenerated email.\nBuild URL: ${env.BUILD_URL}\nBuild Number: ${env.BUILD_NUMBER}\nJob Name: ${env.JOB_NAME}\nThanks,\nDevOps Team"
                emailext attachLog: true, 
                body: emailBody, 
                subject: "Build Status : ${currentBuild.result} || Pipeline Details: ${currentBuild.fullDisplayName}", 
                to: "snehalgawde724@gmail.com",
                mimeType: 'text/html'
            }
        }
        failure {
            script {
                color = (currentBuild.result == "SUCCESS") ? "MediumSeaGreen" : "Tomato"
                fullDisplayName = "${currentBuild.fullDisplayName}"
                result = "${currentBuild.result}"
                buildUrl = "${env.BUILD_URL}"
                buildNumber = "${currentBuild.number}"
                htmlBodyHead = '''<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"></head>'''
                htmlBody = '''<body><div class="card" style="width: 100%;border: 2px solid ''' + color +''';"><div class="status" style="background-color: ''' + color + ''';text-align: center;color: white;"><h1>''' + result + '''</h1></div><div class="container" style="padding: 2px 16px;"><h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbspPipeline Details: ''' + fullDisplayName + '''</h4><h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Build Number: ''' + buildNumber + '''</h4><h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp<a href="''' + buildUrl + '''" style="background-color: white;color: black;border: 2px solid ''' + color + ''';padding: 10px 20px;text-align: center;text-decoration: none;display: inline-block;">Click Here To See The Full Log</a></h4></div><br/></div></body></html>'''
                emailBody = "Hi Sender,\nThis is an autogenerated email.\nBuild URL: ${env.BUILD_URL}\nBuild Number: ${env.BUILD_NUMBER}\nJob Name: ${env.JOB_NAME}\nThanks,\nDevOps Team"
                emailext attachLog: true, 
                body: htmlBodyHead + htmlBody, 
                subject: "Build Status : ${currentBuild.result} || Pipeline Details: ${currentBuild.fullDisplayName}", 
                to: "snehalgawde724@gmail.com",
                mimeType: 'text/html'
            }
        }
        
    }
}
s